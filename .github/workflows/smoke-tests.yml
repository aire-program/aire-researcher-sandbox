name: Smoke Tests

on:
  push:
    paths:
      - 'app/**'
      - 'notebooks/**'
      - 'pipelines/**'
      - 'data/**'
      - 'scripts/**'
      - 'requirements.txt'
  pull_request:
    paths:
      - 'app/**'
      - 'notebooks/**'
      - 'pipelines/**'
      - 'data/**'
      - 'scripts/**'
      - 'requirements.txt'

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt
      - name: Generate synthetic data
        run: python scripts/generate_synthetic_data.py
      - name: Import core components and verify files
        run: |
          python - <<'PY'
          import os
          import streamlit  # noqa: F401
          import app.main  # noqa: F401

          expected = [
              'data/sample_texts/articles_sample.csv',
              'data/sample_texts/notes_sample.csv',
              'data/sample_tabular/experiments_sample.csv',
              'data/sample_tabular/metrics_sample.csv',
          ]
          for path in expected:
              if not os.path.exists(path):
                  raise SystemExit(f"Missing expected file: {path}")
          print("Smoke checks passed")
          PY
